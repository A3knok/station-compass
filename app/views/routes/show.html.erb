<%= content_for(:title, t('.title')) %>

<div class="page-container">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="station-sign-bar mb-3"></div>

        <h2 class="text-center mb-5">
          <i class="fas fa-map-marked-alt me-2 text-info"></i>
          <%= t('.title') %>
        </h2>

        <div class="row mb-4 g-3">
          <%= route_info_card("fas fa-door-open", "primary", :gate_id, @route.gate.name) %>
          <%= route_info_card("fas fas fa-map-marker-alt", "success", :exit_id, @route.exit.name) %>
          <%= route_info_card("fas fa-clock", "warning", :estimated_time, "#{@route.estimated_time}分") %>
        </div>

        <!-- ルート詳細エリア -->
        <div class="card mb-4">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
              <i class="fas fa-info-circle me-2"></i>
              <span class="text-center"><%= t('.title') %></span>
            </h4>
          </div>
          <div class="card-body">
            <dl class="row mb-0">
              <dt class="col-sm-4 text-muted"><%= t('.station') %></dt>
              <dd class="col-sm-8"><%= @station.name %></dd>

              <dt class="col-sm-4 text-muted"><%= t('.gate') %></dt>
              <dd class="col-sm-8"><%= @route.gate.name %></dd>
              
              <dt class="col-sm-4 text-muted"><%= t('.exit') %></dt>
              <dd class="col-sm-8"><%= @route.exit.display_name %></dd>
              
              <dt class="col-sm-4 text-muted"><%= t('.route_text') %></dt>
              <!-- 改行をHTMLタグに変換 -->
              <dd class="col-sm-8">
                <div class="route-description">
                  <%= simple_format(@route.description) %>
                </div>
              </dd>
              
              <dt class="col-sm-4 text-muted"><%= t('.created_at') %></dt>
              <dd class="col-sm-8"><%= l(@route.created_at, format: :route_list) %></dd>

              <dt class="col-sm-4 <%= route_freshness_class(@route) %>">
                <%= t('.updated_at') %>
              </dt>
              <dd class="col-sm-8 mb-0 <%= route_freshness_class(@route) %>">
                <%= l(@route.updated_at, format: :route_list) %>
              </dd>

              <% if route_freshness_message(@route).present? %>
                <dt class="col-sm-4"></dt>
                <dd class="col-sm-8 mb-0 <%= route_freshness_class(@route) %>">
                  <small class="mb-2">
                    <%= route_freshness_message(@route) %>
                  </small>
                </dd>
              <% end %>
            </dl>

            <!-- 画像表示 -->
            <% if @route.images.present? %>
              <div class="mt-4">
                <div id="routeCarousel" class="carousel slide">
                  <!-- カルーセル本体 -->
                  <div class="carousel-inner">
                    <% @route.images.each_with_index do |image, index| %>
                      <div class="carousel-item <%= 'active' if index == 0 %>">
                        <%= image_tag image.thumb.url, class: "img-fluid rounded" %>
                      </div>
                    <% end %>      
                  </div>

                  <!-- 前へボタン -->
                  <button class="carousel-control-prev" type="button" data-bs-target="#routeCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  </button>

                  <!-- 次へボタン -->
                  <button class="carousel-control-next" type="button" data-bs-target="#routeCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  </button>
                </div>
              </div>
            <% end %>

            <!-- やくに立ったボタン -->
            <div class="text-end">
              <%= render "helpful_button", route: @route %>
            </div>
          </div>
        </div>

        <!-- タグリスト -->
        <div class="mb-4">
          <% @route.tags.each do |tag| %>
            <span class="d-inline-block me-2 mb-2 p-1 bg-white "><%= tag.name %></span>
          <% end %>
        </div>

        <!-- カテゴリー -->

        <%= render 'routes/action_buttons', route: @route %>
      </div>
    </div>
  </div>

  <!-- モーダルウィンドウ -->
  <div class="modal fade" id="thanksModal" tabindex="-1">
    <div class="modal-dialog modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="thanksModalLabel">投稿ありがとうございます!</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          他にも知っているルートを共有しませんか？
        </div>

        <div class="modal-footer">
          <%= link_to "続けて投稿する", new_route_path, class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  </div>

  <!-- modal自動表示 -->
  <% if flash[:show_thanks_modal] %>
    <script>
      (() => {
        // scriptが読み込まれた瞬間に実行される
        const modal = new bootstrap.Modal(document.getElementById('thanksModal'));
        modal.show();
      })();
    </script>
  <% end %>
</div>
